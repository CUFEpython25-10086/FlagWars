# FlagWars 局域网游玩指南

## 概述

FlagWars 是一款支持多人对战的夺旗游戏，您可以通过局域网与同学一起游玩。本指南将详细介绍如何在局域网环境中设置和游玩 FlagWars。

## 准备工作

### 1. 确认网络环境
- 确保所有玩家都在同一个局域网内（连接到同一个路由器/交换机）
- 确认网络连接正常，可以互相 ping 通

### 2. 确认系统要求
- Windows 10/11 系统
- 已安装 Python 3.8 或更高版本
- 已安装 uv 包管理器

## 服务器设置步骤

### 步骤 1: 选择一台电脑作为游戏服务器

选择一台性能较好的电脑作为游戏服务器，这台电脑将在整个游戏过程中保持运行。

### 步骤 2: 安装 uv 包管理器（如果尚未安装）

在服务器电脑上打开 PowerShell，执行以下命令：
```powershell
powershell -Command "irm https://astral.sh/uv/install.ps1 | iex"
```

### 步骤 3: 克隆项目（如果尚未下载）

```powershell
git clone https://github.com/yourusername/FlagWars.git
cd FlagWars
```

### 步骤 4: 安装项目依赖

```powershell
uv sync
```

### 步骤 5: 修改服务器配置（可选）

如果您想使用不同的端口或允许外部访问，可以修改 `src/flagwars/server.py` 文件：

```python
# 找到这行代码
server.listen(8888)

# 修改为（允许局域网访问）
server.listen(8888, address='0.0.0.0')
```

### 步骤 6: 启动游戏服务器

在服务器电脑上执行以下命令之一：

```powershell
# 方式1: 使用批处理脚本
start_server.bat

# 方式2: 直接运行
uv run python run_server.py
```

服务器启动后，您将看到类似以下输出：
```
FlagWars服务器启动在 http://localhost:8888
按 Ctrl+C 停止服务器
```

### 步骤 7: 获取服务器局域网 IP 地址

在服务器电脑上打开命令提示符（CMD）或 PowerShell，执行以下命令：

```powershell
ipconfig
```

查找 "IPv4 地址"，通常格式为 `192.168.x.x` 或 `10.x.x.x`。记下这个 IP 地址，例如 `192.168.1.100`。

## 客户端连接步骤

### 步骤 1: 玩家准备

每个玩家电脑上只需要一个现代浏览器（如 Chrome、Firefox、Edge 等），无需安装额外软件。

### 步骤 2: 访问游戏

在每个玩家的浏览器中，输入以下地址：
```
http://[服务器IP地址]:8888
```

例如，如果服务器 IP 是 `192.168.1.100`，则输入：
```
http://192.168.1.100:8888
```

### 步骤 3: 加入游戏

1. 打开游戏页面后，玩家可以创建新房间或加入现有房间
2. 输入玩家名称和选择颜色
3. 等待其他玩家加入（至少需要2名玩家才能开始游戏）
4. 所有玩家准备后，游戏将自动开始

## 游戏玩法

### 基本规则

1. 每个玩家控制一个基地和士兵
2. 使用鼠标选择士兵，使用方向键规划移动
3. 占领对手的基地以获胜
4. 利用不同地形类型制定策略

### 地形类型

- **平原**: 基本地形，每15个游戏刻生成一个士兵
- **基地**: 玩家家园，每游戏刻生成一个士兵
- **塔楼**: 可占领的战略点，占领后每游戏刻生成一个士兵
- **城墙**: 不可通行的障碍，可被士兵摧毁
- **山脉**: 不可通行的天然障碍，无法摧毁
- **沼泽**: 可通行，但会减少站在上面的士兵

## 常见问题与解决方案

### 问题 1: 无法连接到服务器

**解决方案:**
1. 确认服务器电脑已启动游戏服务器
2. 检查防火墙设置，确保 8888 端口已开放
3. 确认输入的服务器 IP 地址正确
4. 尝试 ping 服务器 IP 地址确认网络连通性

### 问题 2: 游戏卡顿或延迟高

**解决方案:**
1. 检查服务器电脑性能，关闭不必要的程序
2. 确认局域网连接稳定
3. 尝试使用有线网络连接代替 Wi-Fi

### 问题 3: 玩家掉线

**解决方案:**
1. 检查网络连接稳定性
2. 刷新浏览器页面重新连接
3. 确认服务器仍在运行

### 问题 4: 防火墙阻止连接

**解决方案:**

在服务器电脑上：
1. 打开 Windows 防火墙设置
2. 点击"允许应用或功能通过 Windows 防火墙"
3. 点击"更改设置"
4. 点击"允许其他应用"
5. 浏览并选择 Python 或手动添加端口 8888
6. 确保勾选"专用"网络类型

或者使用 PowerShell 命令开放端口：
```powershell
New-NetFirewallRule -DisplayName "FlagWars Server" -Direction Inbound -Protocol TCP -LocalPort 8888 -Action Allow
```

## 高级配置

### 修改游戏参数

您可以修改 `src/flagwars/models.py` 文件中的参数来自定义游戏体验：

```python
# 地图大小
def __init__(self, map_width: int = 20, map_height: int = 15):

# 地形生成数量
# 生成塔楼数量 (默认: 5)
for _ in range(5):

# 生成城墙数量 (默认: 10)
for _ in range(10):

# 生成山脉数量 (默认: 8)
for _ in range(8):

# 生成沼泽数量 (默认: 6)
for _ in range(6):
```

### 使用不同端口

如果您想使用其他端口（例如 8080），需要修改两处：

1. 在 `src/flagwars/server.py` 中：
```python
server.listen(8080, address='0.0.0.0')
```

2. 客户端访问地址相应更改为：
```
http://[服务器IP地址]:8080
```

## 小贴士

1. **服务器选择**: 选择性能稳定、网络连接良好的电脑作为服务器
2. **网络优化**: 如果可能，使用有线网络连接代替 Wi-Fi 以获得更稳定的体验
3. **浏览器选择**: 推荐使用 Chrome 或 Firefox 浏览器以获得最佳兼容性
4. **玩家数量**: 建议 2-4 名玩家同时游戏，以获得最佳体验
5. **策略提示**: 合理利用地形优势，控制塔楼可以获得额外兵力

## 总结

通过以上步骤，您应该能够在局域网中与同学成功游玩 FlagWars。如果遇到任何问题，请参考常见问题与解决方案部分，或者检查服务器和客户端的网络配置。

祝您游戏愉快！